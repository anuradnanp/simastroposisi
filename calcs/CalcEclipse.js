/* Copyright (C) 2022 Alma Nuradnan Pramudita (email: gocodealpha@gmail.com)

This file is part of SimAstroPosisi.

SimAstroPosisi is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

SimAstroPosisi is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.

You should have received a copy of the GNU General Public License along with SimAstroPosisi. If not, see <https://www.gnu.org/licenses/>. */

let Eclipse=function(e){let t,a,s,o,n,i,l,r,u,p,c,f,m,d,h,P,I,g,b,v,y,k,A,x,M,B,S,z,C,L,R,w,j,Y,E,Z,F,V,W,X,J,T,G,N,D,O,U,_,q,H,K,Q,$,ee,te,ae,se,oe,ne,ie,le,re,ue,pe,ce,fe,me,de,he,Pe,Ie,ge,be,ve,ye,ke,Ae,xe,Me,Be,Se=10,ze=14;function Ce(e,t){if(e>=0){let a=Math.floor(e),s=e-a;for(a=a.toString();a.length<t;)a="0"+a;return 0!=s&&(s=Math.round(s*Math.pow(10,t))/Math.pow(10,t),s=s.toString(),a+=s.substr(1,s.length-1)),a}{e=Math.abs(e);let a=Math.floor(e),s=e-a;for(a=a.toString();a.length<t;)a="0"+a;return 0!=s&&(s=Math.round(s*Math.pow(10,t))/Math.pow(10,t),s=s.toString(),a+=s.substr(1,s.length-1)),a="-"+a,a}}e.preload=function(){t=e.loadFont("https://anuradnanp.github.io/simastroposisi/aset/Lato-Regular.ttf"),LatoBold=e.loadFont("https://anuradnanp.github.io/simastroposisi/aset/Lato-Bold.ttf"),a=e.loadImage("https://anuradnanp.github.io/simastroposisi/aset/day-night.png"),s=e.loadImage("https://anuradnanp.github.io/simastroposisi/aset/world-wrap.png"),o=e.loadImage("https://anuradnanp.github.io/simastroposisi/aset/moon-wrap-mono.png")},e.setup=function(){e.setAttributes("antialias",!0),n=e.createCanvas(300,300,e.WEBGL),n.position(0,155),n.style("border-radius","0"),S=e.createButton("- 1 menit"),S.position(Se,Se).addClass("leaveAlone"),S.mousePressed(e.min1menit),S.style("font-family","Lato-Regular"),S.style("font-size","14px"),z=e.createButton("+ 1 menit"),z.position(Se,44).addClass("leaveAlone"),z.mousePressed(e.plu1menit),z.style("font-family","Lato-Regular"),z.style("font-size","14px"),C=e.createButton("- 10 menit"),C.position(88,Se).addClass("leaveAlone"),C.mousePressed(e.min10menit),C.style("font-family","Lato-Regular"),C.style("font-size","14px"),L=e.createButton("+ 10 menit"),L.position(88,44).addClass("leaveAlone"),L.mousePressed(e.plu10menit),L.style("font-family","Lato-Regular"),L.style("font-size","14px"),R=e.createButton("- 1 jam"),R.position(173,Se).addClass("leaveAlone"),R.mousePressed(e.min1jam),R.style("font-family","Lato-Regular"),R.style("font-size","14px"),w=e.createButton("+ 1 jam"),w.position(173,44).addClass("leaveAlone"),w.mousePressed(e.plu1jam),w.style("font-family","Lato-Regular"),w.style("font-size","14px"),j=e.createButton("- 6 jam"),j.position(237,Se).addClass("leaveAlone"),j.mousePressed(e.min6jam),j.style("font-family","Lato-Regular"),j.style("font-size","14px"),Y=e.createButton("+ 6 jam"),Y.position(237,44).addClass("leaveAlone"),Y.mousePressed(e.plu6jam),Y.style("font-family","Lato-Regular"),Y.style("font-size","14px"),F=e.createButton("- 1 hari"),F.position(Se,78).addClass("leaveAlone"),F.mousePressed(e.min1hari),F.style("font-family","Lato-Regular"),F.style("font-size","14px"),V=e.createButton("+ 1 hari"),V.position(Se,112).addClass("leaveAlone"),V.mousePressed(e.plu1hari),V.style("font-family","Lato-Regular"),V.style("font-size","14px"),W=e.createButton("- 10 hari"),W.position(77,78).addClass("leaveAlone"),W.mousePressed(e.min10hari),W.style("font-family","Lato-Regular"),W.style("font-size","14px"),X=e.createButton("+ 10 hari"),X.position(77,112).addClass("leaveAlone"),X.mousePressed(e.plu10hari),X.style("font-family","Lato-Regular"),X.style("font-size","14px"),J=e.createButton("- 30 hari"),J.position(153,78).addClass("leaveAlone"),J.mousePressed(e.min30hari),J.style("font-family","Lato-Regular"),J.style("font-size","14px"),T=e.createButton("+ 30 hari"),T.position(153,112).addClass("leaveAlone"),T.mousePressed(e.plu30hari),T.style("font-family","Lato-Regular"),T.style("font-size","14px"),E=e.createButton("- 100 hari"),E.position(228,78).addClass("leaveAlone"),E.mousePressed(e.min100hari),E.style("font-family","Lato-Regular"),E.style("font-size","14px"),Z=e.createButton("+ 100 hari"),Z.position(228,112).addClass("leaveAlone"),Z.mousePressed(e.plu100hari),Z.style("font-family","Lato-Regular"),Z.style("font-size","14px"),B=e.createSlider(0,2*e.PI,2*e.PI*14/60,2*e.PI/120),B.size(260,ze),B.position(20,440),G=e.createSlider(-70,70,-60,.5),G.size(250,ze),G.position(170,295),G.style("transform","rotate(90deg)"),N=2459891.7555555557,D=N,O=.9972695659722222,U=2459891.867974537,_=e.PI-2*e.PI/O*(2459891.867974537-N),q=e.createP(""),q.size(300,20),q.position(Se,468),q.id("tanggal"),q.style("text-align","right"),q.style("font-family","Lato-Bold"),q.style("font-size","15px"),H=e.createP(""),H.size(300,20),H.position(Se,488),H.id("jam"),H.style("text-align","right"),H.style("font-family","Lato-Bold"),H.style("font-size","19px"),e.frameRate(5)},e.posMat=function(t){var a,s,o,n,i,l,r;return a=e.range(280.466+36000.8*t),oe=e.range(357.52999+35999*t-1536e-7*t**2+t**3/2449e4),s=(1.915-.004817*t-14e-6*t**2)*e.sin(oe*e.PI/180),s+=(.01999-101e-6*t)*e.sin(2*oe*e.PI/180),s+=29e-5*e.sin(3*oe*e.PI/180),o=oe+s,te=.99972/(1+(.01671-4204e-8*t-1.236e-7*t**2)*e.cos(o*e.PI/180)),n=a+s,i=e.range(125.04-1934.1*t),n-.00569-.00478*e.sin(i*e.PI/180),se=(84381.448-46.815*t)/3600,l=e.atan2(e.sin(n*e.PI/180)*e.cos(se*e.PI/180)-e.tan(0*e.PI/180)*e.sin(se*e.PI/180),e.cos(n*e.PI/180)),r=e.asin(e.sin(0*e.PI/180)*e.cos(se*e.PI/180)+e.cos(0*e.PI/180)*e.sin(se*e.PI/180)*e.sin(n*e.PI/180)),K=e.atan2(e.sin(l)*e.cos(se*e.PI/180)+e.tan(r)*e.sin(se*e.PI/180),e.cos(l)),Q=e.asin(e.sin(r)*e.cos(se*e.PI/180)-e.cos(r)*e.sin(se*e.PI/180)*e.sin(l)),[149597870.7*te/6371*20*e.cos(-Q)*e.cos(-K),149597870.7*te/6371*20*e.sin(-Q),149597870.7*te/6371*20*e.cos(-Q)*e.sin(-K)]},e.posBul=function(t){var a,s,o,n,i,l,r,u;return a=e.range(93.2721+483202*t-.003403*t**2-t**3/3526e3),s=e.range(218.316+481268*t),e.range(125.045-1934.14*t+.002071*t**2+t**3/45e4),o=e.range(134.963+477199*t+.008997*t**2+t**3/69700),n=2*e.range(297.85+445267*t-.00163*t**2+t**3/545900),ae=1+(-20954*e.cos(o*e.PI/180)-3699*e.cos((n-o)*e.PI/180)-2956*e.cos(n*e.PI/180))/385e3,ae/te/379.168831168831,i=(i=5.128*e.sin(a*e.PI/180)+.2806*e.sin((o+a)*e.PI/180))+.2777*e.sin((o-a)*e.PI/180)+.1732*e.sin((n-a)*e.PI/180),l=(l=6.289*e.sin(o*e.PI/180)+1.274*e.sin((n-o)*e.PI/180)+.6583*e.sin(n*e.PI/180))+.2136*e.sin(2*o*e.PI/180)-.1851*e.sin(oe*e.PI/180)-.1143*e.sin(2*a*e.PI/180),l=(l+=.0588*e.sin((n-2*o)*e.PI/180))+.0572*e.sin((n-oe-o)*e.PI/180)+.0533*e.sin((n+o)*e.PI/180),l+=s,r=e.atan2(e.sin(l*e.PI/180)*e.cos(se*e.PI/180)-e.tan(i*e.PI/180)*e.sin(se*e.PI/180),e.cos(l*e.PI/180)),u=e.asin(e.sin(i*e.PI/180)*e.cos(se*e.PI/180)+e.cos(i*e.PI/180)*e.sin(se*e.PI/180)*e.sin(l*e.PI/180)),$=e.atan2(e.sin(r)*e.cos(se*e.PI/180)+e.tan(u)*e.sin(se*e.PI/180),e.cos(r)),ee=e.asin(e.sin(u)*e.cos(se*e.PI/180)-e.cos(u)*e.sin(se*e.PI/180)*e.sin(r)),[60.268511*ae*20*e.cos(-ee)*e.cos(-$),60.268511*ae*20*e.sin(-ee),60.268511*ae*20*e.cos(-ee)*e.sin(-$)]},e.drawSun=function(){e.push(),e.noStroke(),e.translate(ne[0],ne[1],ne[2]),e.fill(255),e.sphere(696340/6371*20),e.pop(),e.push(),le=e.color(255,255,0),e.abs(G.value())>60?le.setAlpha((3570-51*e.abs(G.value()))/2):le.setAlpha(255),e.stroke(le),e.strokeWeight(1),e.abs(G.value())<70&&e.line(0,0,0,.01*ne[0],.01*ne[1],.01*ne[2]),e.pop()},e.drawMoon=function(){e.push(),e.noStroke(),e.translate(ie[0],ie[1],ie[2]),e.rotateY($+e.PI/2),e.texture(o),e.sphere(1737/6371*19.5),e.pop(),e.push(),e.noStroke(),e.translate(ie[0],ie[1],ie[2]),e.rotateY(e.atan2(ye.x,ye.z)-e.PI/2),e.rotateZ(e.asin(ye.y/ye.mag())),e.texture(a),e.sphere(1737/6371*20),e.pop(),e.push(),re=e.color(255,0,0),e.abs(G.value())>60?re.setAlpha((3570-51*e.abs(G.value()))/2):re.setAlpha(255),e.stroke(re),e.strokeWeight(1),e.abs(G.value())<70&&e.line(0,0,0,ie[0],ie[1],ie[2]),e.pop()},e.drawEarth=function(){e.push(),e.strokeWeight(1),e.noFill(),e.rotateZ(se*e.PI/180),pe=e.color(0,0,0),e.abs(G.value())>60?pe.setAlpha((3570-51*e.abs(G.value()))/2):pe.setAlpha(255),e.stroke(pe),e.abs(G.value())<70&&(e.line(0,20,0,0,30,0),e.line(0,-20,0,0,-30,0)),e.rotateY(2*e.PI/O*(D-N)+_-e.PI/2),e.texture(s),e.noStroke(),e.sphere(19.5),e.pop(),e.push(),e.stroke("#ff0000"),e.noFill(),e.rotateZ(se*e.PI/180),e.rotateX(e.PI/2),e.circle(0,0,39),e.pop(),e.push(),e.noStroke(),e.rotateY(K+e.PI),e.rotateZ(Q),e.texture(a),e.sphere(20),e.pop(),e.push(),e.stroke("#00ff00"),e.noFill(),e.strokeWeight(1),e.rotateX(e.PI/2),e.circle(0,0,2*ae*60.268511*20+6948/6371*20),e.pop()},e.drawUmbra=function(){fe=1737/694603*e.dist(ie[0],ie[1],ie[2],ne[0],ne[1],ne[2]),me=6371/689969*te*149597870.7/6371*20,de=e.color(0,0,0),e.abs(G.value())>60?de.setAlpha((3360-48*e.abs(G.value()))/5):de.setAlpha(96),Me=e.color(0,0,0),e.abs(G.value())>60?Me.setAlpha((48*e.abs(G.value())-2880)/5):Me.setAlpha(0),e.push(),e.abs(G.value())<70&&e.abs(he.angleBetween(ue))>e.asin(1/ae/60.268511)&&(e.noStroke(),e.translate(ie[0],ie[1],ie[2]),e.rotateY(e.atan2(ye.x,ye.z)+e.PI/2),e.rotateZ(e.asin(ye.y/ye.mag())),e.rotateZ(e.PI/2),e.translate(0,fe/2,0),e.fill(de),e.cone(1737/6371*20,fe,40,1)),e.pop(),e.abs(G.value())>60&&(e.push(),e.noStroke(),e.fill(Me),e.translate(-ne[0]*(60.268511*ae*6371-2084.4)/(149597870.7*te),-ne[1]*(60.268511*ae*6371-2084.4)/(149597870.7*te),-ne[2]*(60.268511*ae*6371-2084.4)/(149597870.7*te)),e.rotateY(K+e.PI/2),e.rotateX(Q),e.circle(0,0,40*(5*me-5*ae*60.268511*20+10422/6371*20)/5/me),e.pop()),e.push(),e.noStroke(),e.abs(G.value())<70&&(e.rotateY(K),e.rotateZ(e.PI/2-Q),e.translate(0,me/2,0),e.fill(de),e.cone(20,me,40,1)),e.pop()},e.drawPenumbra=function(){Pe=1737/698077*e.dist(ie[0],ie[1],ie[2],ne[0],ne[1],ne[2]),Ie=6371/702711*te*149597870.7/6371*20,Be=e.color(0,0,0),e.abs(G.value())>60?Be.setAlpha((1680-24*e.abs(G.value()))/5):Be.setAlpha(48),ge=e.color(0,0,0),e.abs(G.value())>60?ge.setAlpha((24*e.abs(G.value())-1440)/5):ge.setAlpha(0),e.push(),e.noStroke(),e.abs(G.value())<70&&e.abs(he.angleBetween(ue))>e.asin(1/ae/60.268511)&&(e.translate(ie[0],ie[1],ie[2]),e.rotateY(e.atan2(ye.x,ye.z)-e.PI/2),e.rotateZ(e.asin(ye.y/ye.mag())),e.rotateZ(e.PI/2),e.translate(0,60.268511*-ae*20/2,0),e.fill(Be),e.truncatedCone(1737/6371*20+.2,1737/6371*20*(Pe+60.268511*ae*20)/Pe,60.268511*ae*20,20)),e.pop(),e.abs(G.value())>60&&(e.push(),e.noStroke(),e.fill(ge),e.translate(-ne[0]*(60.268511*ae*6371-2258.1)/(149597870.7*te),-ne[1]*(60.268511*ae*6371-2258.1)/(149597870.7*te),-ne[2]*(60.268511*ae*6371-2258.1)/(149597870.7*te)),e.rotateY(K+e.PI/2),e.rotateX(Q),e.circle(0,0,40*(10*Ie+10*ae*60.268511*20-22581/6371*20)/10/Ie),e.pop()),e.push(),e.noStroke(),e.abs(G.value())<70&&(e.rotateY(K+e.PI),e.rotateZ(e.PI/2+Q),e.translate(0,-Ie/2,0),e.fill(Be),e.truncatedCone(20.2,40,Ie,20)),e.pop()},e.dispTanggal=function(){I=document.getElementById("tanggal"),I.textContent=b[2]+" "+b[1]+" "+b[0]},e.dispJam=function(){g=document.getElementById("jam"),g.textContent="pukul "+Ce(b[3],2)+":"+Ce(b[4],2)+" GMT"},e.draw=function(){e.background("#d79922"),e.angleMode(e.RADIANS),be=D-2451545,ve=be/36525,e.push(),e.noFill(),e.stroke(0,0,255),e.strokeWeight(1),e.beginShape();for(var t=0;t<27.2;t+=.5)ce=e.posBul(ve-t/36525),e.vertex(61.268511*ce[0]/60.268511,61.268511*ce[1]/60.268511,61.268511*ce[2]/60.268511);e.endShape(e.CLOSE),e.pop(),ne=e.posMat(ve),ie=e.posBul(ve),e.abs(G.value())>60?B.style("visibility","hidden"):B.style("visibility","visible"),e.abs(G.value())<=60?e.camera(200*e.cos(B.value()),G.value(),200*e.sin(B.value()),0,0,0,0,1,0):e.camera(20*(70-e.abs(G.value()))*e.cos(B.value()),(5940*Math.sign(G.value())-79*G.value())/20,20*(70-e.abs(G.value()))*e.sin(B.value()),(e.abs(G.value())-60)*ie[0]/10,(e.abs(G.value())-60)*ie[1]/10,(e.abs(G.value())-60)*ie[2]/10,0,1,0),e.abs(G.value())<=60?e.perspective(e.PI/5,1,160/e.tan(e.PI/6)/100,160/e.tan(e.PI/6)*1800):e.perspective(-e.PI/900*(e.abs(17*G.value())-1200),1,160/e.tan(e.PI/6)/100,160/e.tan(e.PI/6)*1800),ue=e.createVector(ne[0]-ie[0],ne[1]-ie[1],ne[2]-ie[2]),he=e.createVector(-ie[0],-ie[1],-ie[2]),ye=e.createVector(ie[0]-ne[0],ie[1]-ne[1],ie[2]-ne[2]),ke=e.createVector(-ne[0],-ne[1],-ne[2]),Ae=e.createVector(ne[0],ne[1],ne[2]),xe=e.createVector(ie[0],ie[1],ie[2]),e.drawEarth(),e.drawMoon(),e.drawSun(),e.drawUmbra(),e.drawPenumbra(),e.jd2greg(),e.dispTanggal(),e.dispJam()},e.truncatedCone=function(t,a,s,o){e.beginShape(e.TRIANGLE_STRIP);for(var n=0;n<o+1;n++)e.vertex(t*e.cos(2*e.PI/o*n),s/2,t*e.sin(2*e.PI/o*n)),e.vertex(a*e.cos(2*e.PI/o*n),-s/2,a*e.sin(2*e.PI/o*n));e.endShape()},e.min1menit=function(){D-=1/60/24},e.plu1menit=function(){D+=1/60/24},e.min10menit=function(){D-=10/60/24},e.plu10menit=function(){D+=10/60/24},e.min1jam=function(){D-=1/24},e.plu1jam=function(){D+=1/24},e.min6jam=function(){D-=.25},e.plu6jam=function(){D+=.25},e.min1hari=function(){D-=1},e.plu1hari=function(){D+=1},e.min10hari=function(){D-=10},e.plu10hari=function(){D+=10},e.min30hari=function(){D-=30},e.plu30hari=function(){D+=30},e.min100hari=function(){D-=100},e.plu100hari=function(){D+=100},e.mousePressed=function(){e.mouseX>0&&e.mouseX<e.width&&e.mouseY>-150&&e.mouseY<315&&e.frameRate(20)},e.mouseReleased=function(){e.frameRate(5)},e.ipart=function(e){return e>0?Math.floor(e):Math.ceil(e)},e.range=function(t){var a,s;return(a=360*((s=t/360)-e.ipart(s)))<0&&(a+=360),a},e.jd2greg=function(){switch(m=D+.5,P=Math.floor(m),h=m-P,P<2299161?l=P:(i=Math.floor((P-1867216.25)/36524.25),l=P+1+i-Math.floor(i/4)),r=l+1524,u=Math.floor((r-122.1)/365.25),p=Math.floor(365.25*u),d=Math.floor((r-p)/30.6001),c=r-p-Math.floor(30.6001*d),M=24*h,x=Math.floor(M),A=60*(M-x),k=Math.round(A),60==k&&(x+=1,k=0),d<14?f=d-1:14!=d&&15!=d||(f=d-13),f>2?y=u-4716:1!=f&&2!=f||(y=u-4715),f){case 1:v="Januari";break;case 2:v="Februari";break;case 3:v="Maret";break;case 4:v="April";break;case 5:v="Mei";break;case 6:v="Juni";break;case 7:v="Juli";break;case 8:v="Agustus";break;case 9:v="September";break;case 10:v="Oktober";break;case 11:v="November";break;case 12:v="Desember"}return b=[y,v,c,x,k],b}},sketEclipse=new p5(Eclipse,"CalcEclipse");
