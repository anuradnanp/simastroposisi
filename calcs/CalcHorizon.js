/* Copyright (C) 2022 Alma Nuradnan Pramudita (email: gocodealpha@gmail.com)

This file is part of SimAstroPosisi.

SimAstroPosisi is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

SimAstroPosisi is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.

You should have received a copy of the GNU General Public License along with SimAstroPosisi. If not, see <https://www.gnu.org/licenses/>. */

let Horizon=function(h){var a=320,s=10,i=15,t=17;let n,l,M,u,e,r,o,c,f,I,P,p,b,v,d,g,x,m,k,S,z,w,E,F,A,R,T,j,N,C,H,y,L,U,J,O,q,B,D,G,K,W,X,Y,Q,V,Z,$,_,aa;function ta(e,o){if(0<=e){let a=Math.floor(e),t=e-a;for(a=a.toString();a.length<o;)a="0"+a;return 0!=t&&(t=Math.round(t*Math.pow(10,o))/Math.pow(10,o),t=t.toString(),a+=t.substr(1,t.length-1)),a}{e=Math.abs(e);let a=Math.floor(e),t=e-a;for(a=a.toString();a.length<o;)a="0"+a;return 0!=t&&(t=Math.round(t*Math.pow(10,o))/Math.pow(10,o),t=t.toString(),a+=t.substr(1,t.length-1)),a="-"+a,a}}h.setup=function(){h.createCanvas(a,910),h.frameRate(5),n=h.createSlider(-90,90,37,1),l=h.createSlider(-180,180,97,1),M=h.createSlider(0,24,10,.2),u=h.createSlider(-90,90,15,1),r=h.createSlider(1,12,3,1),c=h.createSlider(1,31,20,1),I=h.createSlider(0,23,16,1),P=h.createSlider(0,59,37,1),p=h.createSlider(0,59,0,1),n.position(200,s),l.position(200,35),M.position(200,60),u.position(200,85),r.position(200,110),c.position(200,135),I.position(200,470),P.position(200,495),p.position(200,520),n.size(100,i),l.size(100,i),M.size(100,i),u.size(100,i),r.size(100,i),c.size(100,i),I.size(100,i),P.size(100,i),p.size(100,i)},h.preload=function(){O=h.loadImage("https://anuradnanp.github.io/simastroposisi/aset/web-celestial-coords-landscape-top-down.png"),q=h.loadImage("https://anuradnanp.github.io/simastroposisi/aset/web-celestial-coords-landscape-top-down-kutub.png"),B=h.loadImage("https://anuradnanp.github.io/simastroposisi/aset/web-celestial-coords-landscape-side.png"),D=h.loadImage("https://anuradnanp.github.io/simastroposisi/aset/web-celestial-coords-obj-shadow.png"),G=h.loadImage("https://anuradnanp.github.io/simastroposisi/aset/latar.png"),K=h.loadFont("https://anuradnanp.github.io/simastroposisi/aset/Lato-Regular.ttf"),W=h.loadFont("https://anuradnanp.github.io/simastroposisi/aset/Lato-Bold.ttf")},h.latarWarna=function(){h.image(G,0,0,a,1e3)},h.horizon=function(){h.image(O,35,190,250,250),h.image(B,35,545,250,125),h.noFill()},h.horizonKutub=function(){h.image(q,35,190,250,250),h.image(B,35,545,250,125),h.noFill()},h.obj=function(){for(h.noStroke(),X=0;X<Q[0].length;X++)(90==Math.abs(n.value())||0<Q[0][X])&&(h.fill("#ff0000"),h.circle(160-125*Math.cos(Q[1][X]*Math.PI/180)*Math.cos(Q[0][X]*Math.PI/180),315-125*Math.sin(Q[1][X]*Math.PI/180)*Math.cos(Q[0][X]*Math.PI/180),3),h.noFill());for(X=0;X<Y[0].length;X++)(0==u.value()&&90==Math.abs(n.value())||0<Y[0][X])&&(h.fill("#0000ff"),h.circle(160-125*Math.cos(Y[1][X]*Math.PI/180)*Math.cos(Y[0][X]*Math.PI/180),315-125*Math.sin(Y[1][X]*Math.PI/180)*Math.cos(Y[0][X]*Math.PI/180),3),h.noFill());for(X=0;X<Q[0].length;X++)180<Y[1][X]&&23!=X&&24!=X&&25!=X&&26!=X&&27!=X&&(0<=Q[0][X]||90==Math.abs(n.value())?h.fill("#ff0000"):h.fill("#ffffff"),h.circle(160-125*Math.cos(Q[1][X]*Math.PI/180)*Math.cos(Q[0][X]*Math.PI/180),630-125*Math.sin(Q[0][X]*Math.PI/180)+s+30,3),h.noFill());for(X=0;X<Y[0].length;X++)180<Y[1][X]&&(0<=Y[0][X]||0==u.value()&&90==Math.abs(n.value())?h.fill("#0000ff"):h.fill("#ffffff"),h.circle(160-125*Math.cos(Y[1][X]*Math.PI/180)*Math.cos(Y[0][X]*Math.PI/180),630-125*Math.sin(Y[0][X]*Math.PI/180)+s+30,3),h.noFill());0<=Z||0==u.value()&&90==Math.abs(n.value())?h.fill("#ffff00"):h.fill("#ffffff"),h.circle(160-125*Math.cos(V*Math.PI/180)*Math.cos(Z*Math.PI/180),315-125*Math.sin(V*Math.PI/180)*Math.cos(Z*Math.PI/180),10),h.circle(160-125*Math.cos(V*Math.PI/180)*Math.cos(Z*Math.PI/180),670-125*Math.sin(Z*Math.PI/180),10),h.noFill()},h.shadow=function(){h.image(D,160-125*Math.cos(V*Math.PI/180)*Math.cos(Z*Math.PI/180)-8.5,315-125*Math.sin(V*Math.PI/180)*Math.cos(Z*Math.PI/180)-8.5,t,t),h.image(D,160-125*Math.cos(V*Math.PI/180)*Math.cos(Z*Math.PI/180)-8.5,670-125*Math.sin(Z*Math.PI/180)-8.5,t,t)},h.objPos=function(){return e=2021,f=c.value()+I.value()/24+P.value()/1440+p.value()/86400,o=r.value()<=2?(--e,r.value()+12):r.value(),b=Math.floor(e/100),v=2-b+Math.floor(b/4),d=Math.floor(365.25*(e+4716))+Math.floor(30.6001*(o+1))+f+v-1524.5,g=0!=l.value()?d-Math.abs(l.value())/l.value()*(Math.abs(l.value())/15).round(0)/24:d,x=24*(g-2459293.90069),m=23.93446972222222,k=(24/m*x+21.4952)%24,S=(k+l.value()/15)%24,z=90==Math.abs(n.value())?Math.abs(n.value())/n.value()*89.9999*Math.PI/180:n.value()*Math.PI/180,w=(S-M.value())%24*Math.PI/12,E=u.value()*Math.PI/180,Z=180/Math.PI*Math.asin(Math.sin(E)*Math.sin(z)+Math.cos(E)*Math.cos(z)*Math.cos(w)),V=180/Math.PI*Math.atan2(-Math.sin(w)*Math.cos(E)/Math.cos(Z*Math.PI/180),(Math.sin(E)-Math.sin(z)*Math.sin(Z*Math.PI/180))/Math.cos(z)/Math.cos(Z*Math.PI/180)),V<0&&(V+=360),F=[Z,V],F},h.pathArray=function(){for(A=100,R=[],T=[],Y=[],j=90==Math.abs(n.value())?Math.abs(n.value())/n.value()*89.9999:n.value(),X=0;X<A;X++)N=24*X/A,C=180/Math.PI*Math.asin(Math.sin(u.value()*Math.PI/180)*Math.sin(j*Math.PI/180)+Math.cos(u.value()*Math.PI/180)*Math.cos(j*Math.PI/180)*Math.cos(N*Math.PI/12)),H=180/Math.PI*Math.atan2(-Math.sin(N*Math.PI/12)*Math.cos(u.value()*Math.PI/180)/Math.cos(C*Math.PI/180),(Math.sin(u.value()*Math.PI/180)-Math.sin(j*Math.PI/180)*Math.sin(C*Math.PI/180))/Math.cos(j*Math.PI/180)/Math.cos(C*Math.PI/180)),H<0&&(H+=360),R.push(C),T.push(H);return Y.push(R),Y.push(T),Y},h.pathArrayEqu=function(){for(A=100,y=[],L=[],Q=[],j=90==Math.abs(n.value())?Math.abs(n.value())/n.value()*89.9999:n.value(),X=0;X<A;X++)N=24*X/A,U=180/Math.PI*Math.asin(Math.sin(0)*Math.sin(j*Math.PI/180)+Math.cos(0)*Math.cos(j*Math.PI/180)*Math.cos(N*Math.PI/12)),J=180/Math.PI*Math.atan2(-Math.sin(N*Math.PI/12)*Math.cos(0)/Math.cos(U*Math.PI/180),(Math.sin(0)-Math.sin(j*Math.PI/180)*Math.sin(U*Math.PI/180))/Math.cos(j*Math.PI/180)/Math.cos(U*Math.PI/180)),J<0&&(H=J+360),y.push(U),L.push(J);return Q.push(y),Q.push(L),Q},h.mousePressed=function(){0<h.mouseX&&h.mouseX<h.width&&0<h.mouseY&&h.mouseY<h.height&&h.frameRate(20)},h.mouseReleased=function(){h.frameRate(5)},h.draw=function(){switch(h.background("#ffffff"),h.angleMode(h.RADIANS),h.latarWarna(),h.objPos(),Z=F[0],V=F[1],90==Math.abs(n.value())?h.horizonKutub():h.horizon(),h.fill("#000000"),h.textFont(K),h.textAlign(h.LEFT,h.CENTER),h.textSize(14),h.text("lintang lokasi",s,s,150,i),h.text("bujur lokasi",s,35,150,i),h.text("asensiorekta objek",s,60,150,i),h.text("deklinasi objek",s,85,150,i),h.text("bulan",s,110,150,i),h.text("tanggal",s,135,150,i),h.text("jam",s,470,150,i),h.text("menit",s,495,150,i),h.text("detik",s,520,150,i),r.value()){case 1:_="Januari";break;case 2:_="Februari";break;case 3:_="Maret";break;case 4:_="April";break;case 5:_="Mei";break;case 6:_="Juni";break;case 7:_="Juli";break;case 8:_="Agustus";break;case 9:_="September";break;case 10:_="Oktober";break;case 11:_="November";break;case 12:_="Desember"}h.text(": "+n.value()+"°",130,s,150,i),h.text(": "+l.value()+"°",130,35,150,i),h.text(": "+M.value()+"h",130,60,150,i),h.text(": "+u.value()+"°",130,85,150,i),h.text(": "+_,80,110,150,i),h.text(": "+c.value(),80,135,150,i),h.text(": "+I.value(),80,470,150,i),h.text(": "+P.value(),80,495,150,i),h.text(": "+p.value(),80,520,150,i);let a="U",t="S",e="T",o="B";90==n.value()?(a="S",e="S",o="S"):-90==n.value()&&(t="U",e="U",o="U"),h.fill("#ffffff"),h.stroke("#000000"),h.textSize(18),h.textFont(W),h.textAlign(h.CENTER,h.TOP),h.text(e,160,160),h.text(o,160,430+18/14*i),h.textAlign(h.CENTER,h.CENTER),h.text(o,160,670),h.textAlign(h.RIGHT,h.CENTER),h.text(a,25,315),h.text(a,25,670),h.textAlign(h.LEFT,h.CENTER),h.text(t,295,315),h.text(t,295,670),h.noFill(),h.shadow(),h.pathArray(),h.pathArrayEqu(),h.obj(),$=90==Math.abs(n.value())?(aa="---\nketinggian "+Z.round(1)+"°","---"):(aa="azimut "+V.round(1)+"°\nketinggian "+Z.round(1)+"°",l.value()),h.fill("#000000"),h.noStroke(),h.textFont(W),h.textAlign(h.RIGHT,h.TOP),h.textSize(10),h.text("lokasi: lintang "+n.value()+"°, bujur "+$+"°\nobjek: asensiorekta "+M.value()+"h, deklinasi "+u.value()+"°\n"+c.value()+" "+_+"  pukul "+ta(I.value(),2)+":"+ta(P.value(),2)+":"+ta(p.value(),2),s,805,300,11/14*3*i),h.textSize(20),h.text(aa,s,845.3571428571429,300,45)},Number.prototype.round=function(a){return Math.abs(this)<Math.pow(10,-a)?+(Math.round("0e+"+a)+"e-"+a):+(Math.round(this+"e+"+a)+"e-"+a)}},sketHorizon=new p5(Horizon,"CalcHorizon");
