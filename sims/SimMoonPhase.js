/* Copyright (C) 2022 Alma Nuradnan Pramudita (email: gocodealpha@gmail.com)

This file is part of SimAstroPosisi.

SimAstroPosisi is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

SimAstroPosisi is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.

You should have received a copy of the GNU General Public License along with SimAstroPosisi. If not, see <https://www.gnu.org/licenses/>. */

let MoonPhase=function(e){var t=10,a=14;let o,r,s,i,n,l,u,p,c,P,v,h,I,f,d,g,m,k,y,S,b,w,x,Y,z,B,E;e.preload=function(){o=e.loadFont("https://anuradnanp.github.io/simastroposisi/aset/Lato-Regular.ttf"),r=e.loadFont("https://anuradnanp.github.io/simastroposisi/aset/Lato-Bold.ttf"),s=e.loadImage("https://anuradnanp.github.io/simastroposisi/aset/day-night.png"),i=e.loadImage("https://anuradnanp.github.io/simastroposisi/aset/world-wrap.png"),n=e.loadImage("https://anuradnanp.github.io/simastroposisi/aset/moon-wrap.png")},e.setup=function(){e.setAttributes("antialias",!0),l=e.createCanvas(320,320,e.WEBGL),l.position(0,180),l.style("border-radius","0"),u=e.createP("posisi Bulan terhadap Bumi"),u.style("font-family","Lato-Regular"),u.style("font-size","14px"),u.style("font-weight","normal"),u.position(t,t),p=e.createSlider(0,2*e.PI,2*e.PI*14/60,2*e.PI/60),p.size(260,a),p.position(t,34),c=e.createP("posisi Matahari dari Bumi"),c.style("font-family","Lato-Regular"),c.style("font-size","14px"),c.style("font-weight","normal"),c.position(t,58),P=e.createSlider(0,2*e.PI,2*e.PI*14/60,2*e.PI/60),P.size(260,a),P.position(t,82),v=e.createP("arah bidang orbit Bulan"),v.style("font-family","Lato-Regular"),v.style("font-size","14px"),v.style("font-weight","normal"),v.position(t,106),h=e.createSlider(0,2*e.PI,2*e.PI*14/60,2*e.PI/60),h.size(260,a),h.position(t,130),I=e.createSlider(0,2*e.PI,2*e.PI*14/60,2*e.PI/60),I.size(260,a),I.position(35,465),f=e.createSlider(-70,60,-60,1),f.size(250,a),f.position(180,330),f.style("transform","rotate(90deg)"),e.frameRate(20)},e.drawMoon=function(){return e.push(),e.texture(n),e.noStroke(),e.rotateY(-h.value()),e.rotateZ(-20*e.PI/180),e.translate(240*e.cos(p.value()),0,240*e.sin(p.value())),e.rotateY(-p.value()+e.PI/2),e.rotateZ(20*e.PI/180),e.sphere(9.5),e.pop(),e.push(),e.noStroke(),e.rotateY(-h.value()),e.translate(240*e.cos(p.value())*e.cos(-20*e.PI/180),240*e.cos(p.value())*e.sin(-20*e.PI/180),240*e.sin(p.value())),e.rotateY(-P.value()+h.value()),e.texture(s),e.sphere(10),e.pop(),d=240*e.cos(p.value())*e.cos(-20*e.PI/180),g=240*e.sin(p.value()),m=[d*e.cos(h.value())-g*e.sin(h.value()),240*e.cos(p.value())*e.sin(-20*e.PI/180),d*e.sin(h.value())+g*e.cos(h.value())]},e.drawEarth=function(){e.push(),e.strokeWeight(1),e.noFill(),e.rotateZ(23.44*e.PI/180),e.stroke("#ff0000"),e.line(0,20,0,0,30,0),e.line(0,-20,0,0,-30,0),e.push(),e.rotateX(e.PI/2),e.circle(0,0,39),e.pop(),e.rotateY(e.millis()/1e3),e.texture(i),e.noStroke(),e.sphere(19.5),e.pop(),e.push(),e.rotateY(-P.value()),e.texture(s),e.noStroke(),e.sphere(20),e.pop()},e.drawSun=function(){return e.push(),e.noStroke(),e.fill("#ffff00"),e.translate(-24e3*e.cos(P.value()),0,-24e3*e.sin(P.value())),e.sphere(1e3),e.pop(),k=[-24e3*e.cos(P.value()),0,-24e3*e.sin(P.value())]},e.umbra=function(){y=e.dist(m[0],m[1],m[2],k[0],k[1],k[2])/99,(e.abs(S.angleBetween(b))>e.asin(20/24e3)&&w>e.PI/2||w<=e.PI/2)&&(e.push(),e.noStroke(),e.fill("#00000044"),e.translate(m[0],m[1],m[2]),e.rotateY(-P.value()+e.PI),e.rotateZ(e.PI/2),e.translate(0,y/2,0),e.cone(10,y,24,1,!1),e.pop()),x=24e3/49,e.push(),e.noStroke(),e.fill("#00000044"),e.rotateY(-P.value()+e.PI),e.rotateZ(e.PI/2),e.translate(0,4*x/2,0),e.cone(20,4*x,24,1,!1),e.pop()},e.draw=function(){e.background("#d7eef4"),e.angleMode(e.RADIANS),-61<f.value()?e.camera(200*e.cos(I.value()),f.value(),200*e.sin(I.value()),0,0,0,0,1,0):e.camera((20*f.value()+1400)*e.cos(I.value()),54*f.value()+3180,(20*f.value()+1400)*e.sin(I.value()),0,0,0,e.cos(I.value()),0,e.sin(I.value())),e.perspective(e.PI/3,1,160/e.tan(e.PI/6)/10,160/e.tan(e.PI/6)*90),e.push(),e.noFill(),e.stroke("#0000ff"),e.strokeWeight(1),e.rotateY(-h.value()),e.rotateZ(-20*e.PI/180),e.rotateX(e.PI/2),e.circle(0,0,480),e.pop(),e.push(),e.noFill(),e.stroke("#ffff00"),e.strokeWeight(1),e.rotateY(-P.value()),e.line(0,0,500,0,0,-500),e.pop(),e.push(),e.noFill(),e.stroke("#00ff00"),e.strokeWeight(1),e.rotateX(e.PI/2),e.circle(0,0,480),e.pop(),e.drawSun(),e.drawMoon(),e.drawEarth(),Y=e.createVector(k[0],0,k[2]),z=e.createVector(m[0],0,m[2]),w=e.abs(z.angleBetween(Y)),B=Y.cross(z),E=w<2*e.PI/90&&0<B.y||w<e.PI/90?"Baru":w<43*e.PI/90?0<B.y?"Sabit Awal":"Sabit Akhir":w<47*e.PI/90?0<B.y?"Kuartal Pertama":"Kuartal Ketiga":w<88*e.PI/90?0<B.y?"Cembung Awal":"Cembung Akhir":"Purnama",e.push(),e.fill("#000000"),e.rectMode(e.CENTER),e.textFont(r),e.textSize(20),e.textAlign(e.CENTER,e.CENTER),-61<f.value()?e.translate(m[0],m[1]-35,m[2]):e.translate((f.value()+80)*m[0]/20,(f.value()+80)*m[1]/20-35,(f.value()+80)*m[2]/20),e.rotateY(-I.value()+e.PI/2),f.value()<-60&&e.rotateX(e.PI/20*(60-f.value())),e.text(E,0,0),e.pop(),b=e.createVector(-k[0],-k[1],-k[2]),S=e.createVector(m[0]-k[0],m[1]-k[1],m[2]-k[2]),e.umbra()}},sketMoonPhase=new p5(MoonPhase,"SimMoonPhase");
