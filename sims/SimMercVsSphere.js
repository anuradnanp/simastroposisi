/* Copyright (C) 2022 Alma Nuradnan Pramudita (email: gocodealpha@gmail.com)

This file is part of SimAstroPosisi.

SimAstroPosisi is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

SimAstroPosisi is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.

You should have received a copy of the GNU General Public License along with SimAstroPosisi. If not, see <https://www.gnu.org/licenses/>. */

let MercVsSphere=function(c){let e,t,a,l,I,s,P,o,i,n,u,r,p,f,v,g,h,d,y,m;c.preload=function(){e=c.loadFont("https://anuradnanp.github.io/simastroposisi/aset/Lato-Regular.ttf"),t=c.loadImage("https://anuradnanp.github.io/simastroposisi/aset/world-wrap.png"),a=c.loadImage("https://anuradnanp.github.io/simastroposisi/aset/world-wrap-triple.png")},c.setup=function(){l=c.createCanvas(320,479),l.position(0,220),l.style("border-radius","0"),I=c.createGraphics(320,320,c.WEBGL),I.setAttributes("antialias",!0),c.createP("lintang posisi merah :").style("font-family","Lato-Regular").style("font-size","14px").style("font-weight","normal").position(10,10).style("width","150px").style("text-align","right").style("color","#ff0000"),s=c.createSlider(-90,90,-30,.5),s.size(300,15).position(10,30),c.createP("bujur posisi merah :").style("font-family","Lato-Regular").style("font-size","14px").style("font-weight","normal").position(10,60).style("width","150px").style("text-align","right").style("color","#ff0000"),P=c.createSlider(-180,180,30,.5),P.size(300,15).position(10,80),c.createP("lintang posisi biru :").style("font-family","Lato-Regular").style("font-size","14px").style("font-weight","normal").position(10,110).style("width","150px").style("text-align","right").style("color","#0000ff"),o=c.createSlider(-90,90,30,.5),o.size(300,15).position(10,130),c.createP("bujur posisi biru :").style("font-family","Lato-Regular").style("font-size","14px").style("font-weight","normal").position(10,160).style("width","150px").style("text-align","right").style("color","#0000ff"),i=c.createSlider(-180,180,-40,.5),i.size(300,15).position(10,180),n=c.createSlider(0,2*c.PI,3*c.PI/2,c.PI/30),n.size(280,15).position(10,670),u=c.createSlider(-c.PI/2+.1,c.PI/2-.1,c.PI/4,c.PI/20),u.size(280,15).position(165,519).style("transform","rotate(90deg)"),c.frameRate(5),r=c.createP(""),r.position(170,10).id("lat1Val").style("font-family","Lato-Regular").style("font-size","14px").style("color","#ff0000"),p=c.createP(""),p.position(170,60).id("long1Val").style("font-family","Lato-Regular").style("font-size","14px").style("color","#ff0000"),f=c.createP(""),f.position(170,110).id("lat2Val").style("font-family","Lato-Regular").style("font-size","14px").style("color","#0000ff"),v=c.createP(""),v.position(170,160).id("long2Val").style("font-family","Lato-Regular").style("font-size","14px").style("color","#0000ff")},c.dispCoords=function(){document.getElementById("lat1Val").textContent=s.value()+"째",document.getElementById("long1Val").textContent=P.value()+"째",document.getElementById("lat2Val").textContent=o.value()+"째",document.getElementById("long2Val").textContent=i.value()+"째"},c.draw=function(){c.clear(),c.background("#ffffff"),c.angleMode(c.RADIANS),c.textFont(e),c.textSize(14),c.fill("#000000"),c.noStroke(),g=180<c.abs(P.value()-i.value())?P.value()+Math.sign(P.value())*(360-c.abs(P.value()-i.value())):i.value(),c.push(),c.image(a,0,0,320,159,501+(P.value()+g)/2/180*1503/3/2,0,501,250),c.pop(),I.clear(),I.background("#ffffff"),I.angleMode(c.RADIANS),I.camera(250*c.cos(n.value())*c.cos(u.value()),-250*c.sin(u.value()),250*c.sin(n.value())*c.cos(u.value()),0,0,0,0,1,0),I.textFont(e),I.textSize(14),I.noStroke(),I.push(),I.texture(t),I.sphere(90),I.pop(),90==c.abs(s.value())&&90==c.abs(o.value())&&s.value()*o.value()<0?(180==c.abs(P.value()-g)&&(g+=.01*Math.sign(P.value()-g)),c.plot(s.value(),o.value(),P.value(),g),c.plot(s.value(),o.value(),P.value()-60,g-60),c.plot(s.value(),o.value(),P.value()-120,g-120),c.plot(s.value(),o.value(),P.value()-180,g-180),c.plot(s.value(),o.value(),P.value()+60,g+60),c.plot(s.value(),o.value(),P.value()+120,g+120),c.plot(s.value(),o.value(),P.value()+180,g+180)):s.value()+o.value()==0&&180==c.abs(P.value()-g)?(c.plot(s.value()+.01*c.cos(c.PI/3*0),o.value()+.01*c.cos(-c.PI/3*0),P.value()+.01*c.sin(c.PI/3*0),g+.01*c.sin(-c.PI/3*0)),c.plot(s.value()+.01*c.cos(c.PI/3*1),o.value()+.01*c.cos(-c.PI/3*1),P.value()+.01*c.sin(c.PI/3*1),g+.01*c.sin(-c.PI/3*1)),c.plot(s.value()+.01*c.cos(c.PI/3*2),o.value()+.01*c.cos(-c.PI/3*2),P.value()+.01*c.sin(c.PI/3*2),g+.01*c.sin(-c.PI/3*2)),c.plot(s.value()+.01*c.cos(c.PI/3*3),o.value()+.01*c.cos(-c.PI/3*3),P.value()+.01*c.sin(c.PI/3*3),g+.01*c.sin(-c.PI/3*3)),c.plot(s.value()+.01*c.cos(c.PI/3*4),o.value()+.01*c.cos(-c.PI/3*4),P.value()+.01*c.sin(c.PI/3*4),g+.01*c.sin(-c.PI/3*4)),c.plot(s.value()+.01*c.cos(c.PI/3*5),o.value()+.01*c.cos(-c.PI/3*5),P.value()+.01*c.sin(c.PI/3*5),g+.01*c.sin(-c.PI/3*5))):c.plot(s.value(),o.value(),P.value(),g),I.push(),I.fill("#ff0000"),I.translate(-91*I.sin(P.value()*c.PI/180)*I.cos(-s.value()*c.PI/180),91*I.sin(-s.value()*c.PI/180),-91*I.cos(P.value()*c.PI/180)*I.cos(-s.value()*c.PI/180)),I.sphere(3),I.pop(),I.push(),I.fill("#0000ff"),I.translate(-91*I.sin(g*c.PI/180)*I.cos(-o.value()*c.PI/180),91*I.sin(-o.value()*c.PI/180),-91*I.cos(g*c.PI/180)*I.cos(-o.value()*c.PI/180)),I.sphere(3),I.pop(),(90!=c.abs(s.value())||90!=c.abs(o.value())||0<=s.value()*o.value())&&180!=c.abs(P.value()-g)&&c.plotTri(s.value(),o.value(),P.value(),g),c.push(),c.fill("#ff0000"),c.circle((1440+4*(P.value()-g))/9,(4770-53*s.value())/60,8),c.fill("#0000ff"),c.circle((1440+4*(g-P.value()))/9,(4770-53*o.value())/60,8),c.pop(),c.image(I,0,159),c.dispCoords()},c.plot=function(e,t,a,l){var s,o,i,n,u,r,p,f,v=0;for(180<c.abs(a-l)&&(a=l+Math.sign(l)*(360-c.abs(a-l)),v=1),s=90==c.abs(e)?89.99*Math.sign(e):e,i=90==c.abs(t)?89.99*Math.sign(t):t,s=(90-s)*c.PI/180,o=(90-i)*c.PI/180,i=c.abs(a-l)*c.PI/180,n=c.acos(c.cos(s)*c.cos(o)+c.sin(s)*c.sin(o)*c.cos(i)),u=a==l?s<o?(c.PI,0):c.PI:180==c.abs(a-l)?0<e+t?0:(c.PI,c.PI):(c.acos((c.cos(o)-c.cos(s)*c.cos(n))/c.sin(s)/c.sin(n)),c.acos((c.cos(s)-c.cos(o)*c.cos(n))/c.sin(o)/c.sin(n))),h=15,m=[],d=0;d<h+1;d++)f=n/h*d,r=c.acos(c.cos(o)*c.cos(f)+c.sin(o)*c.sin(f)*c.cos(u)),f=a==l?0:180==c.abs(a-l)?0==u&&d/h<o/n||u==c.PI&&d/h<(c.PI-o)/n?0:c.PI:c.acos((c.cos(f)-c.cos(o)*c.cos(r))/c.sin(o)/c.sin(r)),f=0==d?(p=t,l):(p=180*(c.PI/2-r)/c.PI,l+Math.sign(a-l)*f*180/c.PI),m.push([f,p]);for(c.push(),c.noFill(),c.stroke("#ffff00"),c.strokeWeight(2),c.beginShape(),d=0;d<h+1;d++)c.vertex((1440+8*m[d][0]-4*g-4*P.value())/9,(4770-53*m[d][1])/60);if(c.endShape(),c.pop(),1==v){for(c.push(),c.noFill(),c.stroke("#ffff00"),c.translate(2*((1440+4*(P.value()-g))/9-(1440+4*(g-P.value()))/9),0),c.strokeWeight(2),c.beginShape(),d=0;d<h+1;d++)c.vertex((1440+8*m[d][0]-4*g-4*P.value())/9,(4770-53*m[d][1])/60);c.endShape(),c.pop()}for(I.push(),I.noFill(),I.stroke("#ffff00"),I.strokeWeight(1.5),I.beginShape(),d=0;d<h+1;d++)I.vertex(-91*I.sin(m[d][0]*c.PI/180)*I.cos(-m[d][1]*c.PI/180),91*I.sin(-m[d][1]*c.PI/180),-91*I.cos(m[d][0]*c.PI/180)*I.cos(-m[d][1]*c.PI/180));I.endShape(),I.pop()},c.mousePressed=function(){0<c.mouseX&&c.mouseX<c.width&&-200<c.mouseY&&c.mouseY<470&&c.frameRate(20)},c.mouseReleased=function(){c.frameRate(5)},c.plotTri=function(e,t,a,l){var s,o,i;if(c.push(),c.noStroke(),c.fill("#00000077"),c.beginShape(),0<e+t)for(d=90;d>t;d--)c.vertex((1440+8*l-4*g-4*P.value())/9,(4770-53*d)/60);else for(d=-90;d<t;d++)c.vertex((1440+8*l-4*g-4*P.value())/9,(4770-53*d)/60);for(d=0;d<h+1;d++)c.vertex((1440+8*m[d][0]-4*g-4*P.value())/9,(4770-53*m[d][1])/60);if(0<e+t)for(d=e+1;d<91;d++)c.vertex((1440+8*a-4*g-4*P.value())/9,(4770-53*d)/60);else for(d=e-1;-91<d;d--)c.vertex((1440+8*a-4*g-4*P.value())/9,(4770-53*d)/60);for(c.endShape(c.CLOSE),c.pop(),I.push(),I.fill("#00000077"),I.noStroke(),I.beginShape(c.TRIANGLE_STRIP),d=0;d<h;d++)for(y=0;y<h+1;y++)o=0<e+t?(s=m[y][1]+d*(90-m[y][1])/h,m[y][1]+(d+1)*(90-m[y][1])/h):(s=m[y][1]-d*(90+m[y][1])/h,m[y][1]-(d+1)*(90+m[y][1])/h),i=m[y][0],I.vertex(-92*I.sin(i*c.PI/180)*I.cos(-s*c.PI/180),92*I.sin(-s*c.PI/180),-92*I.cos(i*c.PI/180)*I.cos(-s*c.PI/180)),I.vertex(-92*I.sin(i*c.PI/180)*I.cos(-o*c.PI/180),92*I.sin(-o*c.PI/180),-92*I.cos(i*c.PI/180)*I.cos(-o*c.PI/180));I.endShape(),I.pop()}},SketMercVsSphere=new p5(MercVsSphere,"SimMercVsSphere");
